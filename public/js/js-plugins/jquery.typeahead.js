/*!
 * jQuery Typeahead
 * Copyright (C) 2017 RunningCoder.org
 * Licensed under the MIT license
 *
 * @author Tom Bertrand
 * @version 2.10.0 (2017-9-7)
 * @link http://www.runningcoder.org/jquerytypeahead/
*/ !function(t){if("function"==typeof define&&define.amd)define("jquery-typeahead",["jquery"],function(e){return t(e)});else if("object"==typeof module&&module.exports){var e;module.exports=(void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(void 0)),t(e))}else t(jQuery)}(function(t){"use strict";window.Typeahead={version:"2.9.0"};var e,i={input:null,minLength:2,maxLength:!1,maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,multiselect:null,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,searchOnFocus:!1,blurOnTab:!0,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,templateValue:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onEnter:null,onLeave:null,onClickBefore:null,onClickAfter:null,onDropdownFilter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null,onCancel:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",labelContainer:"typeahead__label-container",label:"typeahead__label",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},o={from:"\xe3\xe0\xe1\xe4\xe2áº½\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf5\xf2\xf3\xf6\xf4\xf9\xfa\xfc\xfb\xf1\xe7",to:"aaaaaeeeeeiiiiooooouuuunc"},s=~window.navigator.appVersion.indexOf("MSIE 9."),n=~window.navigator.appVersion.indexOf("MSIE 10"),r=!!~window.navigator.userAgent.indexOf("Trident")&&~window.navigator.userAgent.indexOf("rv:11"),a=function(t,e){this.rawQuery=t.val()||"",this.query=t.val()||"",this.selector=t[0].selector,this.deferred=null,this.tmpSource={},this.source={},this.dynamicGroups=[],this.hasDynamicGroups=!1,this.generatedGroupCount=0,this.groupBy="group",this.groups=[],this.searchGroups=[],this.generateGroups=[],this.requestGroups=[],this.result=[],this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=e,this.node=t,this.namespace="."+this.helper.slugify.call(this,this.selector)+".typeahead",this.isContentEditable=void 0!==this.node.attr("contenteditable")&&"false"!==this.node.attr("contenteditable"),this.container=null,this.resultContainer=null,this.item=null,this.items=null,this.comparedItems=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={static:[],dynamic:[]},this.dropdownFilterAll=null,this.isDropdownEvent=!1,this.requests={},this.backdrop={},this.hint={},this.label={},this.hasDragged=!1,this.focusOnly=!1,this.__construct()};a.prototype={_validateCacheMethod:function(t){var e;if(!0===t)t="localStorage";else if("string"==typeof t&&!~["localStorage","sessionStorage"].indexOf(t))return this.options.debug&&(h.log({node:this.selector,function:"extendOptions()",message:'Invalid options.cache, possible options are "localStorage" or "sessionStorage"'}),h.print()),!1;e=void 0!==window[t];try{window[t].setItem("typeahead","typeahead"),window[t].removeItem("typeahead")}catch(i){e=!1}return e&&t||!1},extendOptions:function(){if(this.options.cache=this._validateCacheMethod(this.options.cache),this.options.compression&&("object"!=typeof LZString||!this.options.cache)&&(this.options.debug&&(h.log({node:this.selector,function:"extendOptions()",message:"Missing LZString Library or options.cache, no compression will occur."}),h.print()),this.options.compression=!1),(!this.options.maxLength||isNaN(this.options.maxLength))&&(this.options.maxLength=1/0),void 0!==this.options.maxItem&&~[0,!1].indexOf(this.options.maxItem)&&(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.multiselect&&(this.items=[],this.comparedItems=[],"string"==typeof this.options.multiselect.matchOn&&(this.options.multiselect.matchOn=[this.options.multiselect.matchOn])),this.options.group&&(Array.isArray(this.options.group)?this.options.debug&&(h.log({node:this.selector,function:"extendOptions()",message:"options.group must be a boolean|string|object as of 2.5.0"}),h.print()):("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var e=0,s=this.options.dropdownFilter.length;e<s;++e)this.dropdownFilter[this.options.dropdownFilter[e].value?"static":"dynamic"].push(this.options.dropdownFilter[e])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length!==this.options.accent.to.length&&this.options.debug&&(h.log({node:this.selector,function:"extendOptions()",message:'Invalid "options.accent", from and to must be defined and same length.'}),h.print()):this.options.accent=o),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=t(this.options.resultContainer)),this.options.resultContainer instanceof t&&this.options.resultContainer[0]?this.resultContainer=this.options.resultContainer:this.options.debug&&(h.log({node:this.selector,function:"extendOptions()",message:'Invalid jQuery selector or jQuery Object for "options.resultContainer".'}),h.print())),this.options.maxItemPerGroup&&this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=t.extend(!0,{},i,this.options)},unifySourceFormat:function(){var t,e,i;for(t in this.dynamicGroups=[],Array.isArray(this.options.source)&&(this.options.source={group:{data:this.options.source}}),"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source}),this.options.source)if(this.options.source.hasOwnProperty(t)){if("string"==typeof(e=this.options.source[t])&&(e={ajax:{url:e}}),Array.isArray(i=e.url||e.ajax)?(e.ajax="string"==typeof i[0]?{url:i[0]}:i[0],e.ajax.path=e.ajax.path||i[1]||null,delete e.url):("object"==typeof e.url?e.ajax=e.url:"string"==typeof e.url&&(e.ajax={url:e.url}),delete e.url),!e.data&&!e.ajax)return this.options.debug&&(h.log({node:this.selector,function:"unifySourceFormat()",arguments:JSON.stringify(this.options.source),message:'Undefined "options.source.'+t+'.[data|ajax]" is Missing - Typeahead dropped'}),h.print()),!1;e.display&&!Array.isArray(e.display)&&(e.display=[e.display]),e.minLength="number"==typeof e.minLength?e.minLength:this.options.minLength,e.maxLength="number"==typeof e.maxLength?e.maxLength:this.options.maxLength,e.dynamic="boolean"==typeof e.dynamic||this.options.dynamic,e.minLength>e.maxLength&&(e.minLength=e.maxLength),this.options.source[t]=e,this.options.source[t].dynamic&&this.dynamicGroups.push(t),e.cache=void 0!==e.cache?this._validateCacheMethod(e.cache):this.options.cache,e.compression&&("object"!=typeof LZString||!e.cache)&&(this.options.debug&&(h.log({node:this.selector,function:"unifySourceFormat()",message:"Missing LZString Library or group.cache, no compression will occur on group: "+t}),h.print()),e.compression=!1)}return this.hasDynamicGroups=this.options.dynamic||!!this.dynamicGroups.length,!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container),this.options.debug&&(h.log({node:this.selector,function:"init()",message:"OK - Typeahead activated on "+this.selector}),h.print())},delegateEvents:function(){var e=this,i=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"search"+this.namespace,"generate"+this.namespace];t("html").on("touchmove",function(){e.hasDragged=!0}).on("touchstart",function(){e.hasDragged=!1}),this.node.closest("form").on("submit",function(t){if(e.options.mustSelectItem&&e.helper.isEmpty(e.item)){t.preventDefault();return}if(e.options.backdropOnFocus||e.hideLayout(),e.options.callback.onSubmit)return e.helper.executeCallback.call(e,e.options.callback.onSubmit,[e.node,this,e.item||e.items,t])}).on("reset",function(){setTimeout(function(){e.node.trigger("input"+e.namespace),e.hideLayout()})});var o=!1;if(this.node.attr("placeholder")&&(n||r)){var a=!0;this.node.on("focusin focusout",function(){a=!!(!this.value&&this.placeholder)}),this.node.on("input",function(t){a&&(t.stopImmediatePropagation(),a=!1)})}this.node.off(this.namespace).on(i.join(" "),function(i,n){switch(i.type){case"generate":e.generateSource(Object.keys(e.options.source));break;case"focus":if(e.focusOnly){e.focusOnly=!1;break}e.options.backdropOnFocus&&(e.buildBackdropLayout(),e.showLayout()),e.options.searchOnFocus&&(e.deferred=t.Deferred(),e.generateSource());break;case"keydown":i.keyCode&&~[9,13,27,38,39,40].indexOf(i.keyCode)&&(o=!0,e.navigate(i));break;case"keyup":s&&e.node[0].value.replace(/^\s+/,"").toString().length<e.query.length&&e.node.trigger("input"+e.namespace);break;case"propertychange":if(o){o=!1;break}case"input":e.deferred=t.Deferred(),e.isContentEditable?e.rawQuery=e.node.text():e.rawQuery=e.node.val().toString(),e.query=e.rawQuery.replace(/^\s+/,""),""===e.rawQuery&&""===e.query&&(i.originalEvent=n||{},e.helper.executeCallback.call(e,e.options.callback.onCancel,[e.node,i])),e.options.cancelButton&&e.toggleCancelButtonVisibility(),e.options.hint&&e.hint.container&&""!==e.hint.container.val()&&0!==e.hint.container.val().indexOf(e.rawQuery)&&(e.hint.container.val(""),e.isContentEditable&&e.hint.container.text("")),e.hasDynamicGroups?e.helper.typeWatch(function(){e.generateSource()},e.options.delay):e.generateSource();break;case"search":e.searchResult(),e.buildLayout(),e.result.length||e.searchGroups.length&&e.options.emptyTemplate&&e.query.length?e.showLayout():e.hideLayout(),e.deferred&&e.deferred.resolve()}return e.deferred&&e.deferred.promise()}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},filterGenerateSource:function(){for(var t in this.searchGroups=[],this.generateGroups=[],this.options.source)if(this.options.source.hasOwnProperty(t)&&this.query.length>=this.options.source[t].minLength&&this.query.length<=this.options.source[t].maxLength){if(this.searchGroups.push(t),!this.options.source[t].dynamic&&this.source[t])continue;this.generateGroups.push(t)}},generateSource:function(e){if(this.filterGenerateSource(),Array.isArray(e)&&e.length)this.generateGroups=e;else if(!this.generateGroups.length){this.node.trigger("search"+this.namespace);return}if(this.requestGroups=[],this.generatedGroupCount=0,this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var i in this.xhr)this.xhr.hasOwnProperty(i)&&this.xhr[i].abort();this.xhr={}}for(var o,s,n,r,a,l,c,u=this,i=0,p=this.generateGroups.length;i<p;++i){if(o=this.generateGroups[i],r=(n=this.options.source[o]).cache,a=n.compression,r&&(l=window[r].getItem("TYPEAHEAD_"+this.selector+":"+o))){a&&(l=LZString.decompressFromUTF16(l)),c=!1;try{(l=JSON.parse(l+"")).data&&l.ttl>new Date().getTime()?(this.populateSource(l.data,o),c=!0,this.options.debug&&(h.log({node:this.selector,function:"generateSource()",message:'Source for group "'+o+'" found in '+r}),h.print())):window[r].removeItem("TYPEAHEAD_"+this.selector+":"+o)}catch(d){}if(c)continue}if(n.data&&!n.ajax){"function"==typeof n.data?Array.isArray(s=n.data.call(this))?u.populateSource(s,o):"function"==typeof s.promise&&function(e){t.when(s).then(function(t){t&&Array.isArray(t)&&u.populateSource(t,e)})}(o):this.populateSource(t.extend(!0,[],n.data),o);continue}n.ajax&&(this.requests[o]||(this.requests[o]=this.generateRequestObject(o)),this.requestGroups.push(o))}return this.requestGroups.length&&this.handleRequests(),!!this.generateGroups.length},generateRequestObject:function(t){var e=this,i=this.options.source[t],o={request:{url:i.ajax.url||null,dataType:"json",beforeSend:function(o,s){e.xhr[t]=o;var n=e.requests[t].callback.beforeSend||i.ajax.beforeSend;"function"==typeof n&&n.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:i.ajax.path||null,group:t},validForGroup:[t]};if("function"!=typeof i.ajax&&(i.ajax instanceof Object&&(o=this.extendXhrObject(o,i.ajax)),Object.keys(this.options.source).length>1))for(var s in this.requests)this.requests.hasOwnProperty(s)&&!this.requests[s].isDuplicated&&o.request.url&&o.request.url===this.requests[s].request.url&&(this.requests[s].validForGroup.push(t),o.isDuplicated=!0,delete o.validForGroup);return o},extendXhrObject:function(e,i){return"object"==typeof i.callback&&(e.callback=i.callback,delete i.callback),"function"==typeof i.beforeSend&&(e.callback.beforeSend=i.beforeSend,delete i.beforeSend),e.request=t.extend(!0,e.request,i),"jsonp"!==e.request.dataType.toLowerCase()||e.request.jsonpCallback||(e.request.jsonpCallback="callback_"+e.extra.group),e},handleRequests:function(){var e,i=this,o=this.requestGroups.length;if(!1!==this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query]))for(var s=0,n=this.requestGroups.length;s<n;++s)e=this.requestGroups[s],this.requests[e].isDuplicated||function(e,s){if("function"==typeof i.options.source[e].ajax){var n=i.options.source[e].ajax.call(i,i.query);if("object"!=typeof(s=i.extendXhrObject(i.generateRequestObject(e),"object"==typeof n?n:{})).request||!s.request.url){i.options.debug&&(h.log({node:i.selector,function:"handleRequests",message:'Source function must return an object containing ".url" key for group "'+e+'"'}),h.print()),i.populateSource([],e);return}i.requests[e]=s}var r,a=!1,l={};if(~s.request.url.indexOf("{{query}}")&&(a||(s=t.extend(!0,{},s),a=!0),s.request.url=s.request.url.replace("{{query}}",encodeURIComponent(i.query))),s.request.data){for(var c in s.request.data)if(s.request.data.hasOwnProperty(c)&&~String(s.request.data[c]).indexOf("{{query}}")){a||(s=t.extend(!0,{},s),a=!0),s.request.data[c]=s.request.data[c].replace("{{query}}",i.query);break}}t.ajax(s.request).done(function(t,e,o){for(var n,a=0,c=s.validForGroup.length;a<c;a++)n=s.validForGroup[a],(r=i.requests[n]).callback.done instanceof Function&&(l[n]=r.callback.done.call(i,t,e,o),(!Array.isArray(l[n])||"object"!=typeof l[n])&&i.options.debug&&(h.log({node:i.selector,function:"Ajax.callback.done()",message:"Invalid returned data has to be an Array"}),h.print()))}).fail(function(t,e,o){for(var n=0,a=s.validForGroup.length;n<a;n++)(r=i.requests[s.validForGroup[n]]).callback.fail instanceof Function&&r.callback.fail.call(i,t,e,o);i.options.debug&&(h.log({node:i.selector,function:"Ajax.callback.fail()",arguments:JSON.stringify(s.request),message:e}),console.log(o),h.print())}).always(function(t,e,n){for(var a,h=0,c=s.validForGroup.length;h<c;h++){if(a=s.validForGroup[h],(r=i.requests[a]).callback.always instanceof Function&&r.callback.always.call(i,t,e,n),"object"!=typeof n)return;i.populateSource(null!==t&&"function"==typeof t.promise&&[]||l[a]||t,r.extra.group,r.extra.path||r.request.path),0==(o-=1)&&i.helper.executeCallback.call(i,i.options.callback.onReceiveRequest,[i.node,i.query])}}).then(function(t,e){for(var o=0,n=s.validForGroup.length;o<n;o++)(r=i.requests[s.validForGroup[o]]).callback.then instanceof Function&&r.callback.then.call(i,t,e)})}(e,this.requests[e])},populateSource:function(e,i,o){var s=this,n=this.options.source[i],r=n.ajax&&n.data;o&&"string"==typeof o&&(e=this.helper.namespace.call(this,o,e)),void 0===e&&this.options.debug&&(h.log({node:this.selector,function:"populateSource()",arguments:o,message:"Invalid data path."}),h.print()),Array.isArray(e)||(this.options.debug&&(h.log({node:this.selector,function:"populateSource()",arguments:JSON.stringify({group:i}),message:"Invalid data type, must be Array type."}),h.print()),e=[]),r&&("function"==typeof r&&(r=r()),Array.isArray(r)?e=e.concat(r):this.options.debug&&(h.log({node:this.selector,function:"populateSource()",arguments:JSON.stringify(r),message:"WARNING - this.options.source."+i+".data Must be an Array or a function that returns an Array."}),h.print()));for(var a,l=n.display?"compiled"===n.display[0]?n.display[1]:n.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],c=0,u=e.length;c<u;c++){if(null===e[c]||"boolean"==typeof e[c]){this.options.debug&&(h.log({node:this.selector,function:"populateSource()",message:"WARNING - NULL/BOOLEAN value inside "+i+"! The data was skipped."}),h.print());continue}"string"==typeof e[c]&&((a={})[l]=e[c],e[c]=a),e[c].group=i}if(!this.hasDynamicGroups&&this.dropdownFilter.dynamic.length)for(var p,d,f={},c=0,u=e.length;c<u;c++)for(var g=0,m=this.dropdownFilter.dynamic.length;g<m;g++)p=this.dropdownFilter.dynamic[g].key,(d=e[c][p])&&(this.dropdownFilter.dynamic[g].value||(this.dropdownFilter.dynamic[g].value=[]),f[p]||(f[p]=[]),~f[p].indexOf(d.toLowerCase())||(f[p].push(d.toLowerCase()),this.dropdownFilter.dynamic[g].value.push(d)));if(this.options.correlativeTemplate){var y=n.template||this.options.template,b="";if("function"==typeof y&&(y=y.call(this,"",{})),y){if(Array.isArray(this.options.correlativeTemplate))for(var c=0,u=this.options.correlativeTemplate.length;c<u;c++)b+="{{"+this.options.correlativeTemplate[c]+"}} ";else b=y.replace(/<.+?>/g," ").replace(/\s{2,}/," ").trim();for(var c=0,u=e.length;c<u;c++)e[c].compiled=t("<textarea />").html(b.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,i){return s.helper.namespace.call(s,i,e[c],"get","")}).trim()).text();n.display?~n.display.indexOf("compiled")||n.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}else this.options.debug&&(h.log({node:this.selector,function:"populateSource()",arguments:String(i),message:"WARNING - this.options.correlativeTemplate is enabled but no template was found."}),h.print())}this.options.callback.onPopulateSource&&(e=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,e,i,o]),!this.options.debug||e&&Array.isArray(e)||(h.log({node:this.selector,function:"callback.populateSource()",message:'callback.onPopulateSource must return the "data" parameter'}),h.print())),this.tmpSource[i]=Array.isArray(e)&&e||[];var v=this.options.source[i].cache,k=this.options.source[i].compression,$=this.options.source[i].ttl||this.options.ttl;if(v&&!window[v].getItem("TYPEAHEAD_"+this.selector+":"+i)){this.options.callback.onCacheSave&&(e=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,e,i,o]),!this.options.debug||e&&Array.isArray(e)||(h.log({node:this.selector,function:"callback.populateSource()",message:'callback.onCacheSave must return the "data" parameter'}),h.print()));var x=JSON.stringify({data:e,ttl:new Date().getTime()+$});k&&(x=LZString.compressToUTF16(x)),window[v].setItem("TYPEAHEAD_"+this.selector+":"+i,x)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){if(this.generatedGroupCount++,this.generatedGroupCount===this.generateGroups.length){this.xhr={};for(var t=0,e=this.generateGroups.length;t<e;t++)this.source[this.generateGroups[t]]=this.tmpSource[this.generateGroups[t]];this.hasDynamicGroups||this.buildDropdownItemLayout("dynamic"),this.options.loadingAnimation&&this.container.removeClass("loading"),this.node.trigger("search"+this.namespace)}},navigate:function(t){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,t]),27===t.keyCode){t.preventDefault(),this.query.length?(this.resetInput(),this.node.trigger("input"+this.namespace,[t])):(this.node.blur(),this.hideLayout());return}if(this.result.length){var e=this.resultContainer.find("."+this.options.selector.item).not("[disabled]"),i=e.filter(".active"),o=i[0]?e.index(i):null,s=i[0]?i.attr("data-index"):null,n=null,r=null;if(this.clearActiveItem(),this.helper.executeCallback.call(this,this.options.callback.onLeave,[this.node,null!==o&&e.eq(o)||void 0,null!==s&&this.result[s]||void 0,t]),13===t.keyCode){i.length>0&&(t.preventDefault(),"javascript:;"===i.find("a:first")[0].href?i.find("a:first").trigger("click",t):i.find("a:first")[0].click());return}if(39===t.keyCode){null!==o?e.eq(o).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&e.filter('[data-index="'+this.hintIndex+'"]').find("a:first")[0].click();return}9===t.keyCode?this.options.blurOnTab?this.hideLayout():i.length>0?o+1<e.length?(t.preventDefault(),n=o+1,this.addActiveItem(e.eq(n))):this.hideLayout():e.length?(t.preventDefault(),n=0,this.addActiveItem(e.first())):this.hideLayout():38===t.keyCode?(t.preventDefault(),i.length>0?o-1>=0&&(n=o-1,this.addActiveItem(e.eq(n))):e.length&&(n=e.length-1,this.addActiveItem(e.last()))):40===t.keyCode&&(t.preventDefault(),i.length>0?o+1<e.length&&(n=o+1,this.addActiveItem(e.eq(n))):e.length&&(n=0,this.addActiveItem(e.first()))),r=null!==n?e.eq(n).attr("data-index"):null,this.helper.executeCallback.call(this,this.options.callback.onEnter,[this.node,null!==n&&e.eq(n)||void 0,null!==r&&this.result[r]||void 0,t]),t.preventInputChange&&~[38,40].indexOf(t.keyCode)&&this.buildHintLayout(null!==r&&r<this.result.length?[this.result[r]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",t.preventInputChange?this.hint.css.color:null===r&&this.hint.css.color||this.hint.container.css("background-color")||"fff");var a=null===r||t.preventInputChange?this.rawQuery:this.getTemplateValue.call(this,this.result[r]);this.node.val(a),this.isContentEditable&&this.node.text(a),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,e,null!==n&&e.eq(n).find("a:first")||void 0,null!==r&&this.result[r]||void 0,this.query,t])}},getTemplateValue:function(t){if(t){var e=t.group&&this.options.source[t.group].templateValue||this.options.templateValue;if("function"==typeof e&&(e=e.call(this)),!e)return this.helper.namespace.call(this,t.matchedKey,t).toString();var i=this;return e.replace(/\{\{([\w\-.]+)}}/gi,function(e,o){return i.helper.namespace.call(i,o,t,"get","")})}},clearActiveItem:function(){this.resultContainer.find("."+this.options.selector.item).removeClass("active")},addActiveItem:function(t){t.addClass("active")},searchResult:function(t){t||(this.item=null),this.resetLayout(),!1!==this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])&&(this.searchGroups.length&&!(this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit)&&this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]),this.isDropdownEvent&&(this.helper.executeCallback.call(this,this.options.callback.onDropdownFilter,[this.node,this.query,this.filters.dropdown,this.result]),this.isDropdownEvent=!1))},searchResultData:function(){var e,i,o,s,n,r,a,l,c,u,p,d,f,g=this.groupBy,m=null,y=this.query.toLowerCase(),b=this.options.maxItem,v=this.options.maxItemPerGroup,k=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),$={},x="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(y=this.helper.removeAccent.call(this,y));for(var C=0,w=this.searchGroups.length;C<w;++C)if(e=this.searchGroups[C],!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===e){a=void 0!==this.options.source[e].filter?this.options.source[e].filter:this.options.filter,c="function"==typeof this.options.source[e].matcher&&this.options.source[e].matcher||x;for(var q=0,S=this.source[e].length;q<S&&(!(this.resultItemCount>=b)||this.options.callback.onResult);q++)if((!k||this.dynamicFilter.validate.apply(this,[this.source[e][q]]))&&null!==(i=this.source[e][q])&&"boolean"!=typeof i&&(!this.options.multiselect||this.isMultiselectUniqueData(i))){if(this.filters.dropdown&&(i[this.filters.dropdown.key]||"").toLowerCase()!==(this.filters.dropdown.value||"").toLowerCase())continue;if((m="group"===g?e:i[g]?i[g]:i.group)&&!this.result[m]&&(this.result[m]=[],this.resultCountPerGroup[m]=0),v&&"group"===g&&this.result[m].length>=v&&!this.options.callback.onResult)break;n=this.options.source[e].display||this.options.display;for(var A=0,L=n.length;A<L;++A){if(!1!==a){if(void 0===(r=/\./.test(n[A])?this.helper.namespace.call(this,n[A],i):i[n[A]])||""===r){this.options.debug&&($[A]={display:n[A],data:i});continue}r=this.helper.cleanStringFromScript(r)}if("function"==typeof a){if(void 0===(l=a.call(this,i,r)))break;if(!l)continue;"object"==typeof l&&(i=l)}if(~[void 0,!0].indexOf(a)){if(s=(s=r).toString().toLowerCase(),this.options.accent&&(s=this.helper.removeAccent.call(this,s)),o=s.indexOf(y),this.options.correlativeTemplate&&"compiled"===n[A]&&o<0&&/\s/.test(y)){p=!0,d=y.split(" "),f=s;for(var O=0,_=d.length;O<_;O++)if(""!==d[O]){if(!~f.indexOf(d[O])){p=!1;break}f=f.replace(d[O],"")}}if(o<0&&!p||this.options.offset&&0!==o)continue;if(c){if(void 0===(u=c.call(this,i,r)))break;if(!u)continue;"object"==typeof u&&(i=u)}}if(this.resultCount++,this.resultCountPerGroup[m]++,this.resultItemCount<b){if(v&&this.result[m].length>=v)break;this.result[m].push(t.extend(!0,{matchedKey:n[A]},i)),this.resultItemCount++}break}if(!this.options.callback.onResult&&(this.resultItemCount>=b||v&&this.result[m].length>=v&&"group"===g))break}}if(this.options.debug&&!this.helper.isEmpty($)&&(h.log({node:this.selector,function:"searchResult()",arguments:JSON.stringify($),message:"Missing keys for display, make sure options.display is set properly."}),h.print()),this.options.order){var I,n=[];for(var e in this.result)if(this.result.hasOwnProperty(e)){for(var C=0,w=this.result[e].length;C<w;C++)I=this.options.source[this.result[e][C].group].display||this.options.display,~n.indexOf(I[0])||n.push(I[0]);this.result[e].sort(this.helper.sort(n,"asc"===this.options.order,function(t){return t.toString().toUpperCase()}))}}var F=[],j=[];j="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.result).sort(this.helper.sort([],"asc"===this.options.groupOrder,function(t){return t.toString().toUpperCase()})):Object.keys(this.result);for(var C=0,w=j.length;C<w;C++)F=F.concat(this.result[j[C]]||[]);this.groups=JSON.parse(JSON.stringify(j)),this.result=F},buildLayout:function(){this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml]),this.resultHtml instanceof t&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(!1!==this.options.resultContainer){if(this.resultContainer||(this.resultContainer=t("<div/>",{class:this.options.selector.result}),this.container.append(this.resultContainer)),!this.result.length){if(this.options.multiselect&&this.options.multiselect.limit&&this.items.length>=this.options.multiselect.limit)a=this.options.multiselect.limitTemplate?"function"==typeof this.options.multiselect.limitTemplate?this.options.multiselect.limitTemplate.call(this,this.query):this.options.multiselect.limitTemplate.replace(/\{\{query}}/gi,t("<div>").text(this.helper.cleanStringFromScript(this.query)).html()):"Can't select more than "+this.items.length+" items.";else{if(!this.options.emptyTemplate||""===this.query)return;a="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,t("<div>").text(this.helper.cleanStringFromScript(this.query)).html())}}var e,i,o=this.query.toLowerCase();this.options.accent&&(o=this.helper.removeAccent.call(this,o));var s=this,n=this.groupTemplate||"<ul></ul>",r=!1;this.groupTemplate?n=t(n.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(t,e,i,o,n){var l="",h="group"===i?s.groups:[i];if(!s.result.length)return!0===r?"":(r=!0,"<"+e+' class="'+s.options.selector.empty+'">'+a+"</"+e+">");for(var c=0,u=h.length;c<u;++c)l+="<"+e+' data-group-template="'+h[c]+'"><ul></ul></'+e+">";return l})):(n=t(n),this.result.length||n.append(a instanceof t?a:'<li class="'+s.options.selector.empty+'">'+a+"</li>")),n.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var a,l,h,c,u,p,d,f,g,m,y,b,v=this.groupTemplate&&this.result.length&&s.groups||[],k=0,$=this.result.length;k<$;++k)l=(c=this.result[k]).group,u=!this.options.multiselect&&this.options.source[c.group].href||this.options.href,g=[],m=this.options.source[c.group].display||this.options.display,this.options.group&&(l=c[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?h=this.options.group.template.call(this,c):"string"==typeof this.options.group.template&&(h=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(t,e){return s.helper.namespace.call(s,e,c,"get","")}))),n.find('[data-search-group="'+l+'"]')[0]||(this.groupTemplate?n.find('[data-group-template="'+l+'"] ul'):n).append(t("<li/>",{class:s.options.selector.group,html:t("<a/>",{href:"javascript:;",html:h||l,tabindex:-1}),"data-search-group":l}))),this.groupTemplate&&v.length&&~(b=v.indexOf(l||c.group))&&v.splice(b,1),p=t("<li/>",{class:s.options.selector.item+" "+s.options.selector.group+"-"+this.helper.slugify.call(this,l),disabled:!!c.disabled,"data-group":l,"data-index":k,html:t("<a/>",{href:u&&!c.disabled?(e=u,i=c,s.generateHref.call(s,e,i)):"javascript:;",html:function(){if(d=c.group&&s.options.source[c.group].template||s.options.template)"function"==typeof d&&(d=d.call(s,s.query,c)),f=d.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,i){var n=s.helper.cleanStringFromScript(String(s.helper.namespace.call(s,e,c,"get","")));return~(i=i&&i.split("|")||[]).indexOf("slugify")&&(n=s.helper.slugify.call(s,n)),!~i.indexOf("raw")&&!0===s.options.highlight&&o&&~m.indexOf(e)&&(n=s.helper.highlight.call(s,n,o.split(" "),s.options.accent)),n});else{for(var e=0,i=m.length;e<i;e++)void 0!==(y=/\./.test(m[e])?s.helper.namespace.call(s,m[e],c,"get",""):c[m[e]])&&""!==y&&g.push(y);f='<span class="'+s.options.selector.display+'">'+s.helper.cleanStringFromScript(String(g.join(" ")))+"</span>"}(!0===s.options.highlight&&o&&!d||"any"===s.options.highlight)&&(f=s.helper.highlight.call(s,f,o.split(" "),s.options.accent)),t(this).append(f)}})}),function(e,i,o){o.on("click",function(e,o){if(i.disabled||(o&&"object"==typeof o&&(e.originalEvent=o),s.options.mustSelectItem&&s.helper.isEmpty(i))){e.preventDefault();return}if(s.options.multiselect?(s.items.push(i),s.comparedItems.push(s.getMultiselectComparedData(i))):s.item=i,!1!==s.helper.executeCallback.call(s,s.options.callback.onClickBefore,[s.node,t(this),i,e])){if(e.originalEvent&&e.originalEvent.defaultPrevented||e.isDefaultPrevented())return;var n=s.getTemplateValue.call(s,i);s.options.multiselect?(s.query=s.rawQuery="",s.addMultiselectItemLayout(n)):(s.query=s.rawQuery=n,s.isContentEditable&&(s.node.text(s.query),s.helper.setCaretAtEnd(s.node[0]))),s.focusOnly=!0,s.node.val(s.query).focus(),s.searchResult(!0),s.buildLayout(),s.hideLayout(),s.helper.executeCallback.call(s,s.options.callback.onClickAfter,[s.node,t(this),i,e])}}),o.on("mouseenter",function(e){i.disabled||(s.clearActiveItem(),s.addActiveItem(t(this))),s.helper.executeCallback.call(s,s.options.callback.onEnter,[s.node,t(this),i,e])}),o.on("mouseleave",function(e){i.disabled||s.clearActiveItem(),s.helper.executeCallback.call(s,s.options.callback.onLeave,[s.node,t(this),i,e])})}(k,c,p),(this.groupTemplate?n.find('[data-group-template="'+l+'"] ul'):n).append(p);if(this.result.length&&v.length)for(var k=0,$=v.length;k<$;++k)n.find('[data-group-template="'+v[k]+'"]').remove();this.resultHtml=n}},generateHref:function(t,e){var i=this;return"string"==typeof t?t=t.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,o,s){var n=i.helper.namespace.call(i,o,e,"get","");return~(s=s&&s.split("|")||[]).indexOf("slugify")&&(n=this.helper.slugify.call(i,n)),n}):"function"==typeof t&&(t=t.call(this,e)),t},getMultiselectComparedData:function(t){var e="";if(Array.isArray(this.options.multiselect.matchOn))for(var i=0,o=this.options.multiselect.matchOn.length;i<o;++i)e+=void 0!==t[this.options.multiselect.matchOn[i]]?t[this.options.multiselect.matchOn[i]]:"";else{for(var s=JSON.parse(JSON.stringify(t)),n=["group","matchedKey","compiled","href"],i=0,o=n.length;i<o;++i)delete s[n[i]];e=JSON.stringify(s)}return e},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=t.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=t("<div/>",{class:this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(e){if(this.options.hint){if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth())){this.hint.container&&this.hint.container.val("");return}var i,o,s,n=this,r="",e=e||this.result,a=this.query.toLowerCase();if(this.options.accent&&(a=this.helper.removeAccent.call(this,a)),this.hintIndex=null,this.searchGroups.length){if(this.hint.container||(this.hint.css=t.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,float:"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=t("<"+this.node[0].nodeName+"/>",{type:this.node.attr("type"),class:this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){n.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),a){for(var l=0,h=e.length;l<h;l++)if(!e[l].disabled){o=e[l].group,i=this.options.source[o].display||this.options.display;for(var c=0,u=i.length;c<u;c++)if(s=String(e[l][i[c]]).toLowerCase(),this.options.accent&&(s=this.helper.removeAccent.call(this,s)),0===s.indexOf(a)){r=String(e[l][i[c]]),this.hintIndex=l;break}if(null!==this.hintIndex)break}}var p=r.length>0&&this.rawQuery+r.substring(this.query.length)||"";this.hint.container.val(p),this.isContentEditable&&this.hint.container.text(p)}}},buildDropdownLayout:function(){if(this.options.dropdownFilter){var e=this;t("<span/>",{class:this.options.selector.filter,html:function(){t(this).append(t("<button/>",{type:"button",class:e.options.selector.filterButton,style:"display: none;",click:function(){e.container.toggleClass("filter");var i=e.namespace+"-dropdown-filter";t("html").off(i),e.container.hasClass("filter")&&t("html").on("click"+i+" touchend"+i,function(o){t(o.target).closest("."+e.options.selector.filter)[0]&&t(o.target).closest(e.container)[0]||e.hasDragged||(e.container.removeClass("filter"),t("html").off(i))})}})),t(this).append(t("<ul/>",{class:e.options.selector.dropdown}))}}).insertAfter(e.container.find("."+e.options.selector.query))}},buildDropdownItemLayout:function(e){if(this.options.dropdownFilter){var i,o,s=this,n="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",r=this.container.find("."+this.options.selector.dropdown);"static"===e&&(!0===this.options.dropdownFilter||"string"==typeof this.options.dropdownFilter)&&this.dropdownFilter.static.push({key:"group",template:"{{group}}",all:n,value:Object.keys(this.options.source)});for(var a=0,l=this.dropdownFilter[e].length;a<l;a++){Array.isArray((o=this.dropdownFilter[e][a]).value)||(o.value=[o.value]),o.all&&(this.dropdownFilterAll=o.all);for(var h=0,c=o.value.length;h<=c;h++){if(h!==c||a===l-1)(h!==c||a!==l-1||"static"!==e||!this.dropdownFilter.dynamic.length)&&(i=this.dropdownFilterAll||n,o.value[h]?i=o.template?o.template.replace(RegExp("{{"+o.key+"}}","gi"),o.value[h]):o.value[h]:this.container.find("."+s.options.selector.filterButton).html(i),function(e,i,o){r.append(t("<li/>",{class:s.options.selector.dropdownItem+" "+s.helper.slugify.call(s,i.key+"-"+(i.value[e]||n)),html:t("<a/>",{href:"javascript:;",html:o,click:function(t){t.preventDefault(),u.call(s,{key:i.key,value:i.value[e]||"*",template:o})}})}))}(h,o,i))}}this.dropdownFilter[e].length&&this.container.find("."+s.options.selector.filterButton).removeAttr("style")}function u(t){"*"===t.value?delete this.filters.dropdown:this.filters.dropdown=t,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(t.template),this.isDropdownEvent=!0,this.node.trigger("search"+this.namespace),this.options.multiselect&&this.adjustInputSize(),this.node.focus()}},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(t){var e,i,o=null,s=null;for(var n in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(n)&&(i=~n.indexOf(".")?this.helper.namespace.call(this,n,t,"get"):t[n],"|"!==this.filters.dynamic[n].modifier||o||(o=i==this.filters.dynamic[n].value),"&"===this.filters.dynamic[n].modifier)){if(i==this.filters.dynamic[n].value)s=!0;else{s=!1;break}}return e=o,null!==s&&(e=s,!0===s&&null!==o&&(e=o)),!!e},set:function(t,e){var i=t.match(/^([|&])?(.+)/);e?this.filters.dynamic[i[2]]={modifier:i[1]||"|",value:e}:delete this.filters.dynamic[i[2]],this.dynamicFilter.isEnabled&&this.generateSource()},bind:function(){for(var e,i=this,o=0,s=this.options.dynamicFilter.length;o<s;o++){if("string"==typeof(e=this.options.dynamicFilter[o]).selector&&(e.selector=t(e.selector)),!(e.selector instanceof t)||!e.selector[0]||!e.key){this.options.debug&&(h.log({node:this.selector,function:"buildDynamicLayout()",message:'Invalid jQuery selector or jQuery Object for "filter.selector" or missing filter.key'}),h.print());continue}!function(t){t.selector.off(i.namespace).on("change"+i.namespace,function(){i.dynamicFilter.set.apply(i,[t.key,i.dynamicFilter.getValue(this)])}).trigger("change"+i.namespace)}(e)}},getValue:function(t){var e;return"SELECT"===t.tagName?e=t.value:"INPUT"===t.tagName&&("checkbox"===t.type?e=t.checked&&t.getAttribute("value")||t.checked||null:"radio"===t.type&&t.checked&&(e=t.value)),e}},buildMultiselectLayout:function(){if(this.options.multiselect){var e,i=this;this.label.container=t("<span/>",{class:this.options.selector.labelContainer,"data-padding-left":parseFloat(this.node.css("padding-left"))||0,"data-padding-right":parseFloat(this.node.css("padding-right"))||0,"data-padding-top":parseFloat(this.node.css("padding-top"))||0,click:function(e){t(e.target).hasClass(i.options.selector.labelContainer)&&i.node.focus()}}),this.node.closest("."+this.options.selector.query).prepend(this.label.container),this.options.multiselect.data&&(Array.isArray(this.options.multiselect.data)?this.populateMultiselectData(this.options.multiselect.data):"function"==typeof this.options.multiselect.data&&(Array.isArray(e=this.options.multiselect.data.call(this))?this.populateMultiselectData(e):"function"==typeof e.promise&&t.when(e).then(function(t){t&&Array.isArray(t)&&i.populateMultiselectData(t)})))}},isMultiselectUniqueData:function(t){for(var e=!0,i=0,o=this.comparedItems.length;i<o;++i)if(this.comparedItems[i]===this.getMultiselectComparedData(t)){e=!1;break}return e},populateMultiselectData:function(t){for(var e=0,i=t.length;e<i;++e)this.isMultiselectUniqueData(t[e])&&(this.items.push(t[e]),this.comparedItems.push(this.getMultiselectComparedData(t[e])),this.addMultiselectItemLayout(this.getTemplateValue(t[e])));this.node.trigger("search"+this.namespace,{origin:"populateMultiselectData"})},addMultiselectItemLayout:function(e){var i,o=this,s=this.options.multiselect.href?"a":"span",n=t("<span/>",{class:this.options.selector.label,html:t("<"+s+"/>",{text:e,click:function(e){var i=t(this).closest("."+o.options.selector.label),s=o.label.container.find("."+o.options.selector.label).index(i);o.options.multiselect.callback&&o.helper.executeCallback.call(o,o.options.multiselect.callback.onClick,[o.node,o.items[s],e])},href:this.options.multiselect.href?(i=o.items[o.items.length-1],o.generateHref.call(o,o.options.multiselect.href,i)):null})});n.append(t("<span/>",{class:this.options.selector.cancelButton,html:"\xd7",click:function(e){var i=t(this).closest("."+o.options.selector.label),s=o.label.container.find("."+o.options.selector.label).index(i),n=o.items[s];i.remove(),o.items.splice(s,1),o.comparedItems.splice(s,1),o.options.multiselect.callback&&o.helper.executeCallback.call(o,o.options.multiselect.callback.onCancel,[o.node,n,e]),o.adjustInputSize(),o.node.focus()}})),this.label.container.append(n),this.adjustInputSize()},adjustInputSize:function(){var e=this.node[0].getBoundingClientRect().width-(parseFloat(this.label.container.data("padding-right"))||0)-(parseFloat(this.label.container.css("padding-left"))||0),i=0,o=0,s=0,n=!1,r=0;this.label.container.find("."+this.options.selector.label).filter(function(a,l){0===a&&(r=t(l)[0].getBoundingClientRect().height+parseFloat(t(l).css("margin-bottom")||0)),i=t(l)[0].getBoundingClientRect().width+parseFloat(t(l).css("margin-right")||0),s+i>.7*e&&!n&&(o++,n=!0),s+i<e?s+=i:(n=!1,s=i)});var a=parseFloat(this.label.container.data("padding-left")||0)+(n?0:s),l=o*r+parseFloat(this.label.container.data("padding-top")||0);this.container.find("."+this.options.selector.query).find("input, textarea, [contenteditable], .typeahead__hint").css({paddingLeft:a,paddingTop:l})},showLayout:function(){!this.container.hasClass("result")&&(this.result.length||this.options.emptyTemplate||this.options.backdropOnFocus)&&((function e(){var i=this;t("html").off("keydown"+this.namespace).on("keydown"+this.namespace,function(e){e.keyCode&&9===e.keyCode&&setTimeout(function(){t(":focus").closest(i.container).find(i.node)[0]||i.hideLayout()},0)}),t("html").off("click"+this.namespace+" touchend"+this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(e){!t(e.target).closest(i.container)[0]&&e.target.className!==i.options.selector.cancelButton&&!i.hasDragged&&i.hideLayout()})}).call(this),this.container.addClass([this.result.length||this.searchGroups.length&&this.options.emptyTemplate&&this.query.length?"result ":"",this.options.hint&&this.searchGroups.length?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query]))},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&t(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(t("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result={},this.groups=[],this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&(this.hint.container.val(""),this.isContentEditable&&this.hint.container.text(""))},resetInput:function(){this.node.val(""),this.isContentEditable&&this.node.text(""),this.item=null,this.query="",this.rawQuery=""},buildCancelButtonLayout:function(){if(this.options.cancelButton){var e=this;t("<span/>",{class:this.options.selector.cancelButton,html:"\xd7",mousedown:function(t){t.stopImmediatePropagation(),t.preventDefault(),e.resetInput(),e.node.trigger("input"+e.namespace,[t])}}).insertBefore(this.node)}},toggleCancelButtonVisibility:function(){this.container.toggleClass("cancel",!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.buildMultiselectLayout(),this.delegateEvents(),this.buildCancelButtonLayout(),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},removeAccent:function(t){if("string"==typeof t){var e=o;return"object"==typeof this.options.accent&&(e=this.options.accent),t=t.toLowerCase().replace(RegExp("["+e.from+"]","g"),function(t){return e.to[e.from.indexOf(t)]})}},slugify:function(t){return""!==(t=String(t))&&(t=(t=this.helper.removeAccent.call(this,t)).replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),t},sort:function(t,e,i){var o=function(e){for(var o=0,s=t.length;o<s;o++)if(void 0!==e[t[o]])return i(e[t[o]]);return e};return e=[-1,1][+!!e],function(t,i){return e*(((t=o(t))>(i=o(i)))-(i>t))}},replaceAt:function(t,e,i,o){return t.substring(0,e)+o+t.substring(e+i)},highlight:function(t,e,i){t=String(t);var o=i&&this.helper.removeAccent.call(this,t)||t,s=[];Array.isArray(e)||(e=[e]),e.sort(function(t,e){return e.length-t.length});for(var n=e.length-1;n>=0;n--){if(""===e[n].trim()){e.splice(n,1);continue}e[n]=e[n].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}o.replace(RegExp("(?:"+e.join("|")+")(?!([^<]+)?>)","gi"),function(t,e,i){s.push({offset:i,length:t.length})});for(var n=s.length-1;n>=0;n--)t=this.helper.replaceAt(t,s[n].offset,s[n].length,"<strong>"+t.substr(s[n].offset,s[n].length)+"</strong>");return t},getCaret:function(t){var e=0;if(t.selectionStart)return t.selectionStart;if(document.selection){var i=document.selection.createRange();if(null===i)return e;var o=t.createTextRange(),s=o.duplicate();o.moveToBookmark(i.getBookmark()),s.setEndPoint("EndToStart",o),e=s.text.length}else if(window.getSelection){var n=window.getSelection();if(n.rangeCount){var r=n.getRangeAt(0);r.commonAncestorContainer.parentNode==t&&(e=r.endOffset)}}return e},setCaretAtEnd:function(t){if(void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(e)}else if(void 0!==document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(t),o.collapse(!1),o.select()}},cleanStringFromScript:function(t){return"string"==typeof t&&t.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||t},executeCallback:function(t,e){var i;if(t){if("function"==typeof t)i=t;else if(("string"==typeof t||Array.isArray(t))&&("string"==typeof t&&(t=[t,[]]),"function"!=typeof(i=this.helper.namespace.call(this,t[0],window)))){this.options.debug&&(h.log({node:this.selector,function:"executeCallback()",arguments:JSON.stringify(t),message:'WARNING - Invalid callback function"'}),h.print());return}return i.apply(this,(t[1]||[]).concat(e||[]))}},namespace:function(t,e,i,o){if("string"!=typeof t||""===t)return this.options.debug&&(h.log({node:this.options.input||this.selector,function:"helper.namespace()",arguments:t,message:'ERROR - Missing string"'}),h.print()),!1;var s=void 0!==o?o:void 0;if(!~t.indexOf("."))return e[t]||s;for(var n=t.split("."),r=e||window,i=i||"get",a="",l=0,c=n.length;l<c;l++){if(void 0===r[a=n[l]]){if(~["get","delete"].indexOf(i))return void 0!==o?o:void 0;r[a]={}}if(~["set","create","delete"].indexOf(i)&&l===c-1){if("set"!==i&&"create"!==i)return delete r[a],!0;r[a]=s}r=r[a]}return r},typeWatch:(e=0,function(t,i){clearTimeout(e),e=setTimeout(t,i)})}},t.fn.typeahead=t.typeahead=function(t){return l.typeahead(this,t)};var l={typeahead:function(e,i){if(!i||!i.source||"object"!=typeof i.source){h.log({node:e.selector||i&&i.input,function:"$.typeahead()",arguments:JSON.stringify(i&&i.source||""),message:'Undefined "options" or "options.source" or invalid source type - Typeahead dropped'}),h.print();return}if("function"==typeof e){if(!i.input){h.log({node:e.selector,function:"$.typeahead()",message:'Undefined "options.input" - Typeahead dropped'}),h.print();return}e=t(i.input)}if(void 0===e[0].value&&(e[0].value=e.text()),!e.length){h.log({node:e.selector,function:"$.typeahead()",arguments:JSON.stringify(i.input),message:"Unable to find jQuery input element - Typeahead dropped"}),h.print();return}if(1===e.length)return e[0].selector=e.selector||i.input||e[0].nodeName.toLowerCase(),window.Typeahead[e[0].selector]=new a(e,i);for(var o,s={},n=0,r=e.length;n<r;++n)void 0!==s[o=e[n].nodeName.toLowerCase()]&&(o+=n),e[n].selector=o,window.Typeahead[o]=s[o]=new a(e.eq(n),i);return s}},h={table:{},log:function(e){e.message&&"string"==typeof e.message&&(this.table[e.message]=t.extend({node:"",function:"",arguments:""},e))},print:function(){!a.prototype.helper.isEmpty(this.table)&&console&&console.table&&((void 0!==console.group||void 0!==console.table)&&(console.groupCollapsed("--- jQuery Typeahead Debug ---"),console.table(this.table),console.groupEnd()),this.table={})}};return h.log({message:"WARNING - You are using the DEBUG version. Use /dist/jquery.typeahead.min.js in production."}),h.print(),window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){void 0===e&&(e=0),e<0&&(e+=this.length),e<0&&(e=0);for(var i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return -1}),Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),a});